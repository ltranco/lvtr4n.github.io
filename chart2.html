<!DOCTYPE html>
  <title>Vuru Chart Demo</title>
  <meta charset="utf-8">
  <style>
    .arc text {
      font: 10px sans-serif;
      text-anchor: middle;
    }
    .arc path {
      stroke: #fff;
    }
    .middle-text {
      font-size: 70px;
      font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    }
    #tooltip {
        position: absolute;
        height: auto;
        padding: 10px;
        background-color: white;
        -webkit-border-radius: 2px;
        -moz-border-radius: 2px;
        border-radius: 2px;
        -webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
        -mox-box-shadow: 4px 4px 4px 10px rgba(0, 0, 0, 0.4);
        box-shadow: 4px 4px 10px rbga(0, 0, 0, 0.4) pointer-events: none;
    }
    #tooltip.hidden {
        opacity: 0;
    }
  </style>
  <body>
    <div id="tooltip" class="hidden">
      <span id="tooltip_val"></span>
    </div>
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script>
      //Globals
      var width = 500,
          height = 500,
          radius = Math.min(width, height) / 2,

          colors = ["black", "url(#gradient1)", "transparent", 
                    "url(#gradient2)", "transparent", 
                    "url(#gradient3)", "transparent", 
                    "url(#gradient4)", "transparent"],
          pie = d3.layout.pie().sort(null),
          arc = d3.svg.arc().innerRadius(radius - 125).outerRadius(radius - 25),
          arc2 = d3.svg.arc().innerRadius(radius - 125).outerRadius(radius - 80),
          arc3 = d3.svg.arc().innerRadius(radius - 105).outerRadius(radius - 60),
          arc4 = d3.svg.arc().innerRadius(radius - 85).outerRadius(radius - 40),
          arc5 = d3.svg.arc().innerRadius(radius - 65).outerRadius(radius - 20);

      //Create svg and g
      d3.select("body").append("svg")
        .attr("width", width)
        .attr("height", height)
        .append("g")
        .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

      var svg = d3.select("body").select("svg");
      var g = svg.select("g");

      //Add gradient layer
      function addGradient(name, startColor, stopColor) {
        var gradient = svg.append("defs")
                        .append("linearGradient")
                        .attr("id", name)
                        .attr("x1", "0%")
                        .attr("y1", "0%")
                        .attr("x2", "100%")
                        .attr("y2", "100%")
                        .attr("spreadMethod", "pad");
        gradient.append("stop")
          .attr("offset", "0%")
          .attr("stop-color", startColor)
          .attr("stop-opacity", 1);
        gradient.append("stop")
          .attr("offset", "100%")
          .attr("stop-color", stopColor)
          .attr("stop-opacity", 1);
      }

      //Add ring to svg
      function addArc(data, colorCounter, arc) {
        svg.append("g")
          .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")")
          .selectAll("path").data(pie(data))
          .enter()
          .append("path")
          .attr("class", colorCounter == 0 ? "": "ring")
          .attr("fill", function(d, i) { 
            return colorCounter == 0 ? "#263646" :colors[i + colorCounter]; })
          .attr("d", arc)
          .style("filter", "url(#drop-shadow)")
          .on("mouseenter", function(d) {
            var ringUnderMouse = this;
            if(colorCounter != 0 && 
              d3.select(this).attr("fill") != "transparent") {
              d3.select("#tooltip")
                .style("left", d3.event.pageX + "px")
                .style("top", d3.event.pageY + "px")
                .style("opacity", 1)
                .select("#tooltip_val")
                .text(d.value);
              d3.selectAll(".ring")
                .style("opacity", function() { 
                  return (this == ringUnderMouse) ? 1.0 : 0;
                })
                .style("cursor", "pointer");  
            }  
          })
          .on("mouseleave", function() {
            d3.select("#tooltip")
              .style("opacity", 0);
            d3.selectAll("path")
              .style("opacity", 1)
              .style("cursor", "default");
          });
      };

      //Create shadow
      var defs = svg.append("defs");
      var filter = defs.append("filter")
          .attr("id", "drop-shadow")
          .attr("height", "130%");

      filter.append("feGaussianBlur")
          .attr("in", "SourceAlpha")
          .attr("stdDeviation", 5)
          .attr("result", "blur");
      filter.append("feOffset")
          .attr("in", "blur")
          .attr("dx", 5)
          .attr("dy", 5)
          .attr("result", "offsetBlur");
      var feMerge = filter.append("feMerge");
      feMerge.append("feMergeNode")
          .attr("in", "offsetBlur")
      feMerge.append("feMergeNode")
          .attr("in", "SourceGraphic");

      addGradient("gradient1", "#8F69F1", "#673AB7");
      addGradient("gradient2", "#F7C116", "#EDDE5D");
      addGradient("gradient3", "#4BBAC3", "#00CDAC");
      addGradient("gradient4", "#F56E69", "#fe8c00");
      addArc([30000, 30000], 0, arc);
      addArc([30000, 8000],  7, arc2);
      addArc([52000, 20000], 5, arc3);
      addArc([40000, 22000], 3, arc4);
      addArc([30000, 30000], 1, arc5);
      
      /*g.append("text")
        .attr("text-anchor", "middle")
        .attr("class", "middle-text")
        .text("95%");*/

      g.append("image")
        .attr("xlink:href", "http://www.nuorisokirjailijat.fi/uploads/4/5/1/9/45198743/238000966.png")
        .attr("width", "170px")
        .attr("height", "170px")
        .attr("x", -85)
        .attr("y", -85)
        .style("filter", "url(#drop-shadow)");

        
    </script>
</body>