<!DOCTYPE html>
  <title>Vuru Chart Demo</title>
  <meta charset="utf-8">
  <style>
    body {
      font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    }
    .arc text {
      font: 10px sans-serif;
      text-anchor: middle;
    }
    .arc path {
      stroke: #fff;
    }
    #centerTitle {
      font-size: 30px;
      text-anchor: middle;

    }
    #centerSubtitle {
      font-size: 20px;
      text-anchor: middle;
    }
    #centerData {
      font-size: 30px;
      opacity: 0;
      text-anchor: middle;
    }
    #tooltip {
        position: absolute;
        height: auto;
        padding: 10px;
        background-color: white;
        -webkit-border-radius: 2px;
        -moz-border-radius: 2px;
        border-radius: 2px;
        -webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
        -mox-box-shadow: 4px 4px 4px 10px rgba(0, 0, 0, 0.4);
        box-shadow: 4px 4px 10px rbga(0, 0, 0, 0.4) pointer-events: none;
    }
    #tooltip.hidden {
        opacity: 0;
    }
    .menu ul {
      list-style: none;
    }
    .menu ul li {
      padding: 5px;
      width: 300px;
    }
  </style>
  <body>
    <div class="menu">
      <ul>
        <li>Management</li>
        <li>Financial Strength</li>
        <li>Economic Moat</li>
        <li>Dividends and Buybacks</li>
      </ul>
    </div>
    <div id="tooltip" class="hidden">
      <span id="tooltip_val"></span>
    </div>
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script>
      //Globals
      var width = 500,
          height = 500,
          radius = Math.min(width, height) / 2,
          ringCounter = 4,
          colors = ["black", "url(#gradient1)", "transparent", 
                    "url(#gradient2)", "transparent", 
                    "url(#gradient3)", "transparent", 
                    "url(#gradient4)", "transparent"],
          borders = ["#8F69F1", "#F7C116", "#4BBAC3", "#F56E69"],
          pie = d3.layout.pie().sort(null),
          arc = d3.svg.arc().innerRadius(radius - 125).outerRadius(radius - 25),
          arc2 = d3.svg.arc().innerRadius(radius - 125).outerRadius(radius - 80),
          arc3 = d3.svg.arc().innerRadius(radius - 105).outerRadius(radius - 60),
          arc4 = d3.svg.arc().innerRadius(radius - 85).outerRadius(radius - 40),
          arc5 = d3.svg.arc().innerRadius(radius - 65).outerRadius(radius - 20),
          arc6 = d3.svg.arc().innerRadius(0).outerRadius(radius - 25);

      //Create svg and g
      d3.select("body").append("svg")
        .attr("width", width)
        .attr("height", height)
        .append("g")
        .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

      var svg = d3.select("body").select("svg");
      var g = svg.select("g");

      //Add gradient layer
      function addGradient(name, startColor, stopColor) {
        var gradient = svg.append("defs")
                        .append("linearGradient")
                        .attr("id", name)
                        .attr("x1", "0%")
                        .attr("y1", "0%")
                        .attr("x2", "100%")
                        .attr("y2", "100%")
                        .attr("spreadMethod", "pad");
        gradient.append("stop")
          .attr("offset", "0%")
          .attr("stop-color", startColor)
          .attr("stop-opacity", 1);
        gradient.append("stop")
          .attr("offset", "100%")
          .attr("stop-color", stopColor)
          .attr("stop-opacity", 1);
      }

      //Add ring to svg
      function addArc(data, colorCounter, arc, innerRad, outerRad) {
        var sum = 0;
        for(var i = 0; i < data.length; i++) {
          sum += data[i];
        }
        var endAngle = parseFloat((data[0]/sum * Math.PI * 2).toFixed(2));

        var g = svg.append("g")
          .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

        var path = g.selectAll("path").data(pie([0, 0]))
          .enter()
          .append("path")
          .attr("class", colorCounter == 0 ? "": "ring")
          .attr("ringNum", ringCounter--)
          .attr("ringData", data[0])
          .attr("fill", function(d, i) { 
            return colorCounter == 0 ? "#314965" :colors[i + colorCounter]; })
          .attr("d", arc.endAngle(colorCounter == 0 ? 2 * Math.PI : 0.5))
          //.attr("d", arc)
          .style("filter", "url(#drop-shadow)");
        path = d3.select(path[0][0]);

        if(path && colorCounter != 0) {
          path.transition()
          .duration(2000)
          .call(arcTween, endAngle, innerRad, outerRad);
        }
      };

      //Animation tween function
      function arcTween(transition, newAngle, innerRad, outerRad) {
        transition.attrTween("d", function(d) {
          var interpolate = d3.interpolate(d.endAngle, newAngle);
          return function(t) {
            return drawArc(interpolate(t), innerRad, outerRad);
          };
        });
      }
      var drawArc = d3.svg.arc()
                      .innerRadius(function(d, i, o) {
                        return i;
                      })
                      .outerRadius(function(d, i, o) {
                        return o;
                      })
                      .startAngle(0)
                      .endAngle(function(d, i, o) {
                        return d;
                      });

      //Add listener to menu list
      d3.selectAll(".menu li")
        .data([0, 1, 2, 3])
        .on("mouseenter", function(d) {
          var centerData = 0;
          d3.select(this)
            .style("background-color", borders[d]);
          d3.selectAll(".ring")
            .style("opacity", function() { 
                return (d3.select(this).attr("fill") != "transparent" && 
                        d3.select(this).attr("ringNum") == d) ? 1.0 : 0;
            });
          d3.select("#centerTitle")
            .style("opacity", 0);
          d3.select("#centerSubtitle")
            .style("opacity", 0);
          
          d3.selectAll(".ring").each(function() {
            var ring = d3.select(this)[0][0];
            ring = d3.select(ring);
            if(ring.attr("fill") != "transparent" &&
               ring.attr("ringNum") == d)
              centerData = ring.attr("ringData");
          });    
          d3.select("#centerData")
            .style("opacity", 1)
            .text(centerData);
        })
        .on("mouseleave", function() {
          d3.select(this)
            .style("background-color", "transparent");
          d3.selectAll(".ring")
            .style("opacity", 1.0);
          d3.select("#centerTitle")
            .style("opacity", 1.0);
          d3.select("#centerSubtitle")
            .style("opacity", 1.0);
          d3.select("#centerData")
            .style("opacity", 0);
        });

      //Create shadow
      var defs = svg.append("defs");
      var filter = defs.append("filter")
          .attr("id", "drop-shadow")
          .attr("height", "130%");

      filter.append("feGaussianBlur")
          .attr("in", "SourceAlpha")
          .attr("stdDeviation", 5)
          .attr("result", "blur");
      filter.append("feOffset")
          .attr("in", "blur")
          .attr("dx", 5)
          .attr("dy", 5)
          .attr("result", "offsetBlur");
      var feMerge = filter.append("feMerge");
      feMerge.append("feMergeNode")
          .attr("in", "offsetBlur")
      feMerge.append("feMergeNode")
          .attr("in", "SourceGraphic");

      addGradient("gradient1", "#8F69F1", "#673AB7");
      addGradient("gradient2", "#F7C116", "#EDDE5D");
      addGradient("gradient3", "#4BBAC3", "#00CDAC");
      addGradient("gradient4", "#F56E69", "#fe8c00");
      
      addArc([0, 30000], 0, arc6, 0, 0);
      //addArc([30000, 30000], 0, arc);
      addArc([30000, 8000],  7, arc2, radius - 125, radius - 80);
      addArc([52000, 20000], 5, arc3, radius - 105, radius - 60);
      addArc([40000, 22000], 3, arc4, radius - 85, radius - 40);
      addArc([30000, 30000], 1, arc5, radius - 65, radius - 20);

      //ADD TEXT
      var txt = svg.append("g")
                .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")")
                .append("text");
      
      txt.append("tspan")
        .attr("id", "centerTitle")
        .style('fill', "white")
        .text("VURU Grade");
      txt.append("tspan")
        .attr("x", 0)
        .attr("y", 32)
        .attr("id", "centerSubtitle")
        .style('fill', "white")
        .text("95/100");
      txt.append("tspan")
        .attr("x", 0)
        .attr("y", 0)
        .attr("id", "centerData")
        .style('fill', "white")
        .text("30000");
            
    </script>
</body>